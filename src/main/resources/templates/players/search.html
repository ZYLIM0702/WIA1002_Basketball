<!DOCTYPE html>
<html lang="en-US" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">


    <head>
        <meta charset="UTF-8"/>
        <title>Player Search</title>
        <style>
            body {
                font-family: knockout wide, sans-serif;
                margin: 0;
                padding: 0;
                background-color: #f0f0f0;
            }

            .container {
                display: flex;
            }

            .sidebar {
                flex-basis: 20%;
                padding: 20px;
                height: 100%;
                position: sticky;
                top: 0;
                overflow-y: auto;
                display: flex;
                flex-direction: column;
                justify-content: space-evenly;
                border: 3px solid #000; /* Add border */
                border-radius: 0px; /* Optional: Add border radius */
                margin-top: -120px;
            }

            .content {
                flex-basis: 70%;
                padding: 20px;
            }

            .sidebar h1 {
                 text-align: center;
                 font-family: knockout wide, sans-serif;
                 font-weight: 300;
            }

            .sidebar form {
                background-color: #fff;
                padding: 20px;
                border-radius: 20px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }

            .sidebar form label {
                display: block;
                margin-bottom: 40px;
            }

            .sidebar form input[type="text"],
            .sidebar form input[type="number"],
            .sidebar form select {
                width: calc(100% - 20px);
                padding: 10px;
                margin-bottom: 30px;
                border: 1px solid #ccc;
                border-radius: 15px;
            }

            .sidebar form button[type="submit"] {
                width: calc(100% - 20px);
                padding: 10px;
                background-color: #666666;
                color: #fff;
                border: none;
                border-radius: 5px;
                cursor: pointer;
            }

            .sidebar form button[type="submit"]:hover {
                background-color: #222222;
            }

            .sidebar form button[type="submit"]:active {
                background-color: #1e466c;
            }
            
            .starred {
                display: flex;
                margin-bottom: -2px; /* Increased margin-bottom to add more space */
            }
            
            .content h2 {
                text-align: center;
                color: #333;
            }

            .content table {
                width: 100%;
                border-collapse: collapse;
                margin-top: 20px;
            }

            .content th,
            .content td {
                padding: 10px;
                border: 1px solid #ddd;
                text-align: left;
            }

            .content th {
                background-color: #f2f2f2;
            }

            .content img {
                max-width: 100%;
                height: auto;
            }
            /*---------------------------------------*/
            .container {
    display: flex;
    height: 100vh; /* Ensure the container fills the viewport height */
}

.sidebar {
    flex-basis: 30%;
    padding: 20px;
    position: sticky; /* Make the sidebar sticky */
    top: 0; /* Stick to the top of the container */
    overflow-y: auto; /* Enable vertical scrolling */
}

.content {
    flex-basis: 70%;
    padding: 20px;
    overflow-y: auto; /* Enable vertical scrolling */
}

.heightSlider{
    margin-bottom : 50px;
}


.noUi-tooltip {
    font-size: 13px; /* Adjust the font size as needed */
}

.noUi-connect {
            background: repeating-linear-gradient(
                45deg,            /* Angle of the stripes */
                #999999,          /* Stripe color */
                #999999 10px,     /* Stripe width */
                #cccccc 10px,     /* Space color */
                #cccccc 20px      /* Space width + Stripe width */
            )!important;
        }

 /*-------------------------------------------------*/
            
            
        </style>
    </head>
    <body>
                <link rel="stylesheet" href="../header-style.css">
        <div th:replace="fragments/header :: header"></div>

        <div class="container">
            <div class="sidebar">
                <form id="searchForm">
                     <h1><b>Search Bar</b></h1>
                    
                    <input type="text" id="name" name="name" th:value="${param.name}" placeholder="Name">
                        
                        <select id="country" name="country">
                                <option value="">Select Country Code</option>
                                <div th:each="country : ${allCountries}">
                                    <option th:value="${country}" th:text="${country}" th:selected="${country == param.country}"></option>
                                </div>
                        </select>
                            
                            <select id="position" name="position">
                                <option value="">Select Position</option>
                                <div th:each="position : ${allPositions}">
                                    <option th:value="${position}" th:text="${position}" th:selected="${position == param.position}"></option>
                                </div>
                            </select>
                               
                                                           
<!-- Age Range -->
<label for="ageRange" style="margin-bottom: 20px; padding-bottom: 20px; padding-top: 0px">Age Range:</label>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/14.6.3/nouislider.min.css">
<div id="ageSlider"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/14.6.3/nouislider.min.js"></script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
     var param = {};
  const ageSlider = document.getElementById('ageSlider');
  const minAgeInput = document.getElementById('minAge');
  const maxAgeInput = document.getElementById('maxAge');
  noUiSlider.create(ageSlider, {
    start: [22, 40], // Initial values
    connect: true, // Draw a colored bar between the handles
    tooltips: [true, true], // Display tooltips for both handles
    range: {
      'min': 20,
      'max': 45
    }
  });
 //Update hidden input fields with slider values
    ageSlider.noUiSlider.on('update', function (values, handle) {
        const leftValue = parseInt(values[0]); //age only accepts int
        const rightValue = parseInt(values[1]);

        minAgeInput.value = leftValue;
        param.minAge = minAgeInput.value;
        maxAgeInput.value = rightValue;
        param.maxAge = maxAgeInput.value;
    });
    });
  // Listen for changes on the slider
  ageSlider.noUiSlider.on('update', function(values, handle) {
    console.log('Slider values:', values);
  });
</script>


<!-- Include necessary CSS and JavaScript files for the range slider -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/14.6.3/nouislider.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/14.6.3/nouislider.min.js"></script>
<l<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/14.6.3/nouislider.min.css">
<label for="heightRange" style="margin-bottom: 20px; padding-bottom: 20px; padding-top: 20px">Height Range:</label>
<!-- Create a container for the range slider -->
<div id="heightSlider"></div>

<!-- JavaScript to initialize the range slider -->
<script>
    // Wait for the DOM to be fully loaded
    document.addEventListener('DOMContentLoaded', function () {
        var param = {};

        // Select the height slider container element
        const heightSlider = document.getElementById('heightSlider');
        const minHeightInput = document.getElementById('minHeight');
        const maxHeightInput = document.getElementById('maxHeight');

        // Get the initial values for the slider from the server-side parameters
        //const initialMinHeight = ${param.minHeight || 5.0);
        //const initialMaxHeight = ${param.maxHeight || 8.0};
        const initialMinHeight = 5.0;
        const initialMaxHeight = 8.0;

        // Create the range slider with initial values
        noUiSlider.create(heightSlider, {
            start: [initialMinHeight, initialMaxHeight], // Initial values
            connect: true, // Draw a colored bar between the handles
            tooltips: [true, true], // Display tooltips for both handles
            range: {
                'min': 5.0,
                'max': 8.0
            }
        });

        // Update hidden input fields with slider values
        heightSlider.noUiSlider.on('update', function (values, handle) {
            const leftValue = parseFloat(values[0]);
            const rightValue = parseFloat(values[1]);

            minHeightInput.value = leftValue;
            param.minHeight = minHeightInput.value;
            maxHeightInput.value = rightValue;
            param.maxHeight = maxHeightInput.value;
        });
    });
        // Listen for changes on the slider
        heightSlider.noUiSlider.on('update', function (values, handle) {
            console.log('Slider values:', values);
        });

</script>

                                <div class="starred">
                    <p>Starred Player : </p>
                    <input type="checkbox" id="starred" name="starred" value="true">
                </div>

                                            
                                                <input type="hidden" id="minHeight" name="minHeight">
                                                    <input type="hidden" id="maxHeight" name="maxHeight">
                                                        <input type="hidden" id="minAge" name="minAge">
                                                            <input type="hidden" id="maxAge" name="maxAge">
                                                <button type="submit">Search</button>
                                                </form>
                                                </div>
            
            

                                                <!------------------------------2nd class----------------------------------->
                                                <div class="content">
                                                    <h2>Search Results</h2>
                                                    <div id="searchResults">
                                                        <table border="1" class="player-row">
                                                            <tr>
                                                                <th>Name</th>
                                                                <th>Image</th>
                                                                <th>Overall Score</th>
                                                                <th>Age</th>
                                                                <th>Height</th>
                                                                <th>Position</th>
                                                                <th>Country Code</th>
                                                                <th>View Profile</th>
                                                            </tr>
                                                            <tr th:each="player : ${players}">
                                                                <td th:text="${player.name}"></td>
                                                                <td><img th:src="${player.Image}" width="320"/></td>
                                                                <td th:text="${#numbers.formatDecimal(player.overallScore, 2, 'POINT', 2, 'POINT')}"></td>
                                                                <td th:text="${player.age}"></td>
                                                                <td th:text="${player.height}"></td>
                                                                <td th:text="${player.position}"></td>
                                                                <td th:text="${player.country}"></td>

                                                                <td>
                                                                    <form th:action="@{/players/profile/{playerId}(playerId=${player.playerId})}" method="get">
                                                                        <button type="submit">View Profile</button>
                                                                    </form>
                                                                    <form action="/players/edit" method="get">
                                                                        <input type="hidden" name="playerId" th:value="${player.playerId}"/>
                                                                        <button type="submit">Update</button>
                                                                    </form>
                                                                </td>
                                                            </tr>
                                                        </table>
                                                    </div>
                                                </div>
                                                </div>
                                                </div>
                                                <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
                                                <script>
    $(document).ready(function () {
        var timeoutId;
        var autoUpdateEnabled = false;

        $('#autoUpdateToggle').click(function () {
            autoUpdateEnabled = !autoUpdateEnabled;
            if (autoUpdateEnabled) {
                $('#autoUpdateToggle').text('Disable Live Search');
                updateSearchAutomatically();
            } else {
                $('#autoUpdateToggle').text('Live Search');
                clearTimeout(timeoutId);
            }
        });
        function updateSearchAutomatically() {
            timeoutId = setTimeout(function () {
                $('#searchForm').trigger('submit');
                updateSearchAutomatically();
            }, 1000);
        }

        $('#searchForm').submit(function (event) {
            event.preventDefault();
            var formData = $(this).serialize();

            $.ajax({
                type: 'GET',
                url: '/players/search',
                data: formData,
                success: function (response) {
                    $('#searchResults').empty();
                    var table = $('<table>').addClass('content');//search-results-table
                    $('#searchResults').append(table);
                    $(response).find('.player-row').each(function () {
                        table.append($(this));
                    });
                },
                error: function (xhr, status, error) {
                    console.error(xhr.responseText);
                }
            });
        });
    });
                                                </script>
                                                </body>
                                                </html>